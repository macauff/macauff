<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>macauff.galaxy_counts &#8212; macauff</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=4848ba22" />
    <link rel="stylesheet" type="text/css" href="../../_static/pyramid.css?v=a5b9c134" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../f-modindex.html" title="Fortran Module Index"
             >fortran modules</a> |</li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">macauff</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">macauff.galaxy_counts</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for macauff.galaxy_counts</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Provides the framework for simulating brightness distributions of galaxies</span>
<span class="sd">in any chosen filterset by parameterised double Schechter functions.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Linear1D</span><span class="p">,</span> <span class="n">Exponential1D</span>
<span class="kn">from</span> <span class="nn">astropy.cosmology</span> <span class="kn">import</span> <span class="n">default_cosmology</span>
<span class="kn">import</span> <span class="nn">skypy.galaxies</span> <span class="k">as</span> <span class="nn">skygal</span>
<span class="kn">from</span> <span class="nn">speclite.filters</span> <span class="kn">import</span> <span class="n">FilterResponse</span><span class="p">,</span> <span class="n">load_filters</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;create_galaxy_counts&#39;</span><span class="p">,</span> <span class="s1">&#39;generate_speclite_filters&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="create_galaxy_counts">
<a class="viewcode-back" href="../../api/macauff.create_galaxy_counts.html#macauff.create_galaxy_counts">[docs]</a>
<span class="k">def</span> <span class="nf">create_galaxy_counts</span><span class="p">(</span><span class="n">cmau_array</span><span class="p">,</span> <span class="n">mag_bins</span><span class="p">,</span> <span class="n">z_array</span><span class="p">,</span> <span class="n">wav</span><span class="p">,</span> <span class="n">alpha0</span><span class="p">,</span> <span class="n">alpha1</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span>
                         <span class="n">ab_offset</span><span class="p">,</span> <span class="n">filter_name</span><span class="p">,</span> <span class="n">al_grid</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create a simulated distribution of galaxy magnitudes for a particular</span>
<span class="sd">    bandpass by consideration of double Schechter functions (for blue and</span>
<span class="sd">    red galaxies) in a specified range of redshifts, following [1]_.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cmau_array : numpy.ndarray</span>
<span class="sd">        Array holding the c/m/a/u values that describe the parameterisation</span>
<span class="sd">        of the Schechter functions with wavelength, following Wilson (2022, RNAAS,</span>
<span class="sd">        6, 60) [1]_. Shape should be `(5, 2, 4)`, with 5 parameters for both</span>
<span class="sd">        blue and red galaxies.</span>
<span class="sd">    mag_bins : numpy.ndarray</span>
<span class="sd">        The apparent magnitudes at which to evaluate the on-sky differential</span>
<span class="sd">        galaxy density.</span>
<span class="sd">    z_array : numpy.ndarray</span>
<span class="sd">        Redshift bins to evaluate Schechter densities in the middle of.</span>
<span class="sd">    wav : float</span>
<span class="sd">        The wavelength, in microns, of the bandpass observations should be</span>
<span class="sd">        simulated in. Should likely be the effective wavelength.</span>
<span class="sd">    alpha0 : list of numpy.ndarray or numpy.ndarray</span>
<span class="sd">        List of arrays of parameters :math:`\alpha_{i, 0}` used to calculate</span>
<span class="sd">        Dirichlet-distributed SED coefficients. Should either be a two-element</span>
<span class="sd">        list of arrays of 5 elements, or an array of shape ``(2, 5)``, with</span>
<span class="sd">        coefficients for blue galaxies before red galaxies. See [2]_ and [3]_</span>
<span class="sd">        for more details.</span>
<span class="sd">    alpha1 : list of numpy.ndarray or numpy.ndarray</span>
<span class="sd">        :math:`\alpha_{i, 1}` used in the calculation of Dirichlet-distributed SED</span>
<span class="sd">        coefficients. Two-element list or ``(2, 5)`` shape array of blue</span>
<span class="sd">        then red galaxy coefficients.</span>
<span class="sd">    weight : list of numpy.ndarray or numpy.ndarray</span>
<span class="sd">        Corresponding weights for the derivation of Dirichlet `kcorrect`</span>
<span class="sd">        coefficients. Must match shape of ``alpha0`` and ``alpha1``.</span>
<span class="sd">    ab_offset : float</span>
<span class="sd">        Zeropoint offset for differential galaxy count observations in a</span>
<span class="sd">        non-AB magnitude system. Must be in the sense of m_desired = m_AB - offset.</span>
<span class="sd">    filter_name : str</span>
<span class="sd">        ``speclite`` compound filterset-filter name for the response curve</span>
<span class="sd">        of the particular observations. If observations are in a filter system</span>
<span class="sd">        not provided by ``speclite``, response curve can be generated using</span>
<span class="sd">        ``generate_speclite_filters``.</span>
<span class="sd">    al_grid : list or numpy.ndarray of floats</span>
<span class="sd">        The reddenings at infinity by which to extinct all galaxy magnitudes,</span>
<span class="sd">        for various different potential sub-sightlines within a field of view.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    gal_dens : numpy.ndarray</span>
<span class="sd">        Simulated numbers of galaxies per square degree per magnitude in the</span>
<span class="sd">        specified observed bandpass.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Wilson T. J. (2022), RNAAS, 6, 60</span>
<span class="sd">    .. [2] Herbel J., Kacprzak T., Amara A., et al. (2017), JCAP, 8, 35</span>
<span class="sd">    .. [3] Blanton M. R., Roweis S. (2007), AJ, 133, 734</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">cosmology</span> <span class="o">=</span> <span class="n">default_cosmology</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">gal_dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mag_bins</span><span class="p">)</span>
    <span class="n">log_wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">wav</span><span class="p">)</span>

    <span class="n">alpha0_blue</span><span class="p">,</span> <span class="n">alpha0_red</span> <span class="o">=</span> <span class="n">alpha0</span>
    <span class="n">alpha1_blue</span><span class="p">,</span> <span class="n">alpha1_red</span> <span class="o">=</span> <span class="n">alpha1</span>
    <span class="n">weight_blue</span><span class="p">,</span> <span class="n">weight_red</span> <span class="o">=</span> <span class="n">weight</span>

    <span class="c1"># Currently just set up a very wide absolute magnitude bin range to ensure</span>
    <span class="c1"># we get the dynamic range right. Inefficient but should be reliable...</span>
    <span class="n">abs_mag_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1100</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">mini_z_array</span> <span class="o">=</span> <span class="n">z_array</span><span class="p">[[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mini_z_array</span><span class="p">)</span>

        <span class="n">phi_model1</span> <span class="o">=</span> <span class="n">generate_phi</span><span class="p">(</span><span class="n">cmau_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">log_wav</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">abs_mag_bins</span><span class="p">)</span>
        <span class="n">phi_model2</span> <span class="o">=</span> <span class="n">generate_phi</span><span class="p">(</span><span class="n">cmau_array</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">log_wav</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">abs_mag_bins</span><span class="p">)</span>

        <span class="c1"># differential_comoving_volume is &quot;per redshift per steradian&quot; at each</span>
        <span class="c1"># redshift, so we take the average and &quot;integrate&quot; over z.</span>
        <span class="n">dV_dOmega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cosmology</span><span class="o">.</span><span class="n">differential_comoving_volume</span><span class="p">(</span>
            <span class="n">mini_z_array</span><span class="p">)</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="s1">&#39;Mpc3 / deg2&#39;</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">mini_z_array</span><span class="p">)</span>

        <span class="n">model_densities</span> <span class="o">=</span> <span class="p">[</span><span class="n">phi_model1</span> <span class="o">*</span> <span class="n">dV_dOmega</span><span class="p">,</span> <span class="n">phi_model2</span> <span class="o">*</span> <span class="n">dV_dOmega</span><span class="p">]</span>

        <span class="c1"># Blanton &amp; Roweis (2007) kcorrect templates, via skypy.</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">skygal</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">kcorrect</span><span class="o">.</span><span class="n">wavelength</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">skygal</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">kcorrect</span><span class="o">.</span><span class="n">templates</span>
        <span class="c1"># Generate redshifts and coefficients and k-corrections for each</span>
        <span class="c1"># realisation, and then take the median k-correction.</span>
        <span class="k">for</span> <span class="n">_alpha0</span><span class="p">,</span> <span class="n">_alpha1</span><span class="p">,</span> <span class="n">_weight</span><span class="p">,</span> <span class="n">model_density</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="p">[</span><span class="n">alpha0_blue</span><span class="p">,</span> <span class="n">alpha0_red</span><span class="p">],</span> <span class="p">[</span><span class="n">alpha1_blue</span><span class="p">,</span> <span class="n">alpha1_red</span><span class="p">],</span>
                <span class="p">[</span><span class="n">weight_blue</span><span class="p">,</span> <span class="n">weight_red</span><span class="p">],</span> <span class="n">model_densities</span><span class="p">):</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
            <span class="n">redshift</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">z_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">z_array</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>
            <span class="n">spectral_coefficients</span> <span class="o">=</span> <span class="n">skygal</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">dirichlet_coefficients</span><span class="p">(</span>
                <span class="n">redshift</span><span class="o">=</span><span class="n">redshift</span><span class="p">,</span> <span class="n">alpha0</span><span class="o">=</span><span class="n">_alpha0</span><span class="p">,</span> <span class="n">alpha1</span><span class="o">=</span><span class="n">_alpha1</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">_weight</span><span class="p">)</span>

            <span class="n">kcorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">redshift</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">redshift</span><span class="p">)):</span>
                <span class="n">_z</span> <span class="o">=</span> <span class="n">redshift</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">load_filters</span><span class="p">(</span><span class="n">filter_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fs</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_shifted</span><span class="p">(</span><span class="n">_z</span><span class="p">)</span>
                <span class="n">non_shift_ab_maggy</span><span class="p">,</span> <span class="n">shift_ab_maggy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">non_shift_ab_maggy</span> <span class="o">+=</span> <span class="n">spectral_coefficients</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">f</span><span class="o">.</span><span class="n">get_ab_maggies</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                                                                                             <span class="n">w</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">_t</span><span class="p">,</span> <span class="n">_w</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">pad_spectrum</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
                        <span class="n">non_shift_ab_maggy</span> <span class="o">+=</span> <span class="n">spectral_coefficients</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">fs</span><span class="o">.</span><span class="n">get_ab_maggies</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span>
                                                                                              <span class="n">_w</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">shift_ab_maggy</span> <span class="o">+=</span> <span class="n">spectral_coefficients</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">fs</span><span class="o">.</span><span class="n">get_ab_maggies</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">w</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">_t</span><span class="p">,</span> <span class="n">_w</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">pad_spectrum</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
                        <span class="n">shift_ab_maggy</span> <span class="o">+=</span> <span class="n">spectral_coefficients</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">fs</span><span class="o">.</span><span class="n">get_ab_maggies</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="n">_w</span><span class="p">)</span>
                <span class="c1"># Backwards to Hogg+ astro-ph/0210394, our &quot;shifted&quot; bandpass is the rest-frame</span>
                <span class="c1"># as opposed to the observer frame.</span>
                <span class="n">kcorr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">_z</span><span class="p">)</span> <span class="o">*</span> <span class="n">shift_ab_maggy</span> <span class="o">/</span> <span class="n">non_shift_ab_maggy</span><span class="p">)</span>
            <span class="c1"># Take the average of the NxM AVs that went into al_grid.</span>
            <span class="k">for</span> <span class="n">al</span> <span class="ow">in</span> <span class="n">al_grid</span><span class="p">:</span>
                <span class="c1"># e.g. Loveday+2015 for absolute -&gt; apparent magnitude conversion</span>
                <span class="n">gal_dens</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">mag_bins</span><span class="p">,</span> <span class="n">abs_mag_bins</span> <span class="o">+</span> <span class="n">cosmology</span><span class="o">.</span><span class="n">distmod</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">kcorr</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="o">-</span> <span class="n">ab_offset</span> <span class="o">+</span> <span class="n">al</span><span class="p">,</span>
                                      <span class="n">model_density</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">al_grid</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gal_dens</span></div>



<span class="k">def</span> <span class="nf">generate_phi</span><span class="p">(</span><span class="n">cmau_array</span><span class="p">,</span> <span class="n">cmau_ind</span><span class="p">,</span> <span class="n">log_wav</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">abs_mag_bins</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generate a Schechter (1976) [1]_ function from interpolated,</span>
<span class="sd">    wavelength-dependent parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cmau_array : numpy.ndarray</span>
<span class="sd">        A shape ``(5, 2, 4)`` array, containing the c, m, a, and u parameters</span>
<span class="sd">        for  :math:`M^*_0`, :math:\phi^*_0`, :math:`\alpha`, P, and Q for &quot;blue&quot;</span>
<span class="sd">        and &quot;red&quot; galaxies respectively.</span>
<span class="sd">    cmau_ind : {0, 1}</span>
<span class="sd">        Value indicating whether we&#39;re generating galaxy densities for blue</span>
<span class="sd">        or red galaxies.</span>
<span class="sd">    log_wav : float</span>
<span class="sd">        The log-10 value of the wavelength of the particular observations, in</span>
<span class="sd">        microns.</span>
<span class="sd">    z : float</span>
<span class="sd">        The redshift at which to evaluate the Schechter luminosity function.</span>
<span class="sd">    abs_mag_bins : numpy.ndarray</span>
<span class="sd">        The absolute magnitudes at which to evaluate the Schechter function.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    phi_model : numpy.ndarray</span>
<span class="sd">        The Schechter function differential galaxy density at ``z``.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Schechter P. (1976), ApJ, 203, 297</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">M_star0</span> <span class="o">=</span> <span class="n">function_evaluation_lookup</span><span class="p">(</span><span class="n">cmau_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cmau_ind</span><span class="p">,</span> <span class="n">log_wav</span><span class="p">)</span>
    <span class="n">phi_star0</span> <span class="o">=</span> <span class="n">function_evaluation_lookup</span><span class="p">(</span><span class="n">cmau_array</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmau_ind</span><span class="p">,</span> <span class="n">log_wav</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">function_evaluation_lookup</span><span class="p">(</span><span class="n">cmau_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cmau_ind</span><span class="p">,</span> <span class="n">log_wav</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">function_evaluation_lookup</span><span class="p">(</span><span class="n">cmau_array</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">cmau_ind</span><span class="p">,</span> <span class="n">log_wav</span><span class="p">)</span>
    <span class="c1"># All other parameters are a function of wavelength, but we want Q(P).</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">function_evaluation_lookup</span><span class="p">(</span><span class="n">cmau_array</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">cmau_ind</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
    <span class="c1"># phi*(z) = phi* * 10**(0.4 P z) = phi* exp(0.4 * ln(10) P z)</span>
    <span class="c1"># and thus Exponential1D being of the form exp(x / tau),</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
    <span class="n">m_star</span> <span class="o">=</span> <span class="n">Linear1D</span><span class="p">(</span><span class="n">slope</span><span class="o">=-</span><span class="n">Q</span><span class="p">,</span> <span class="n">intercept</span><span class="o">=</span><span class="n">M_star0</span><span class="p">)</span>
    <span class="n">phi_star</span> <span class="o">=</span> <span class="n">Exponential1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="n">phi_star0</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="n">tau</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">0.4</span> <span class="o">*</span> <span class="p">(</span><span class="n">abs_mag_bins</span> <span class="o">-</span> <span class="n">m_star</span><span class="p">(</span><span class="n">z</span><span class="p">)))</span>
    <span class="n">phi_model</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">phi_star</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">phi_model</span>


<span class="k">def</span> <span class="nf">function_evaluation_lookup</span><span class="p">(</span><span class="n">cmau</span><span class="p">,</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generate the appropriate parameterisation derived by Wilson (2022) [1]_</span>
<span class="sd">    based on Schechter function parameter wavelength dependencies.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cmau : numpy.ndarray</span>
<span class="sd">        Array holding the c/m/a/u values that describe the parameterisation</span>
<span class="sd">        of the Schechter functions. Shape should be `(5, 2, 4)`, with 5</span>
<span class="sd">        parameters for both blue and red galaxies.</span>
<span class="sd">    ind1, ind2 : integer</span>
<span class="sd">        The indices into the specific parameter and galaxy type respectively to</span>
<span class="sd">        derive parameter value for.</span>
<span class="sd">    x : float</span>
<span class="sd">        The variable controlling the change in the particular Schechter function</span>
<span class="sd">        parameter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The evaluation of the parameterisation of this Schechter parameter</span>
<span class="sd">        at a given wavelength, with the particular functional form dictated by</span>
<span class="sd">        whether ``a`` or ``u`` have been fit for previously.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Wilson T. J. (2022), RNAAS, 6, 60</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">cmau</span><span class="p">[</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span>


<div class="viewcode-block" id="generate_speclite_filters">
<a class="viewcode-back" href="../../api/macauff.generate_speclite_filters.html#macauff.generate_speclite_filters">[docs]</a>
<span class="k">def</span> <span class="nf">generate_speclite_filters</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">filter_names</span><span class="p">,</span> <span class="n">wavelength_list</span><span class="p">,</span> <span class="n">response_list</span><span class="p">,</span>
                              <span class="n">wavelength_unit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convenience function to create a new set of ``speclite`` filters, if bandpasses</span>
<span class="sd">    other than those provided in the module already are required. Currently, this</span>
<span class="sd">    generates a temporary ``speclite.filters.FilterResponse`` object that can be</span>
<span class="sd">    loaded using the standard ``speclite`` syntax of ``group_name-band_name``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    group_name : string</span>
<span class="sd">        The overall name to be given to the set of filters being generated. For</span>
<span class="sd">        example, ``speclite`` currently provide ``sdss2010``.</span>
<span class="sd">    filter_names : list of string</span>
<span class="sd">        The individual names of each filter to be generated. For the above example</span>
<span class="sd">        of ``sdss2010``, ``filter_names`` would be ``[u, g, r, i, z]``.</span>
<span class="sd">    wavelength_list : list of numpy.ndarray</span>
<span class="sd">        The wavelengths of the filter response curves being loaded, corresponding</span>
<span class="sd">        to each entry in ``filter_names``.</span>
<span class="sd">    response_list : list of numpy.ndarray</span>
<span class="sd">        The response curve values of the filters, for each ``wavelength_list`` item.</span>
<span class="sd">        Each element in the list should also match an entry in ``filter_names``.</span>
<span class="sd">    wavelength_unit : ``astropy.units.Unit`` object</span>
<span class="sd">        The relevant ``astropy`` unit (e.g., ``u.micron``, ``u.angstrom``) for the</span>
<span class="sd">        units all ``wavelength_list`` entries are given in. All response curves</span>
<span class="sd">        currently have to be in common units.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">filt_name</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">response</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">filter_names</span><span class="p">,</span> <span class="n">wavelength_list</span><span class="p">,</span> <span class="n">response_list</span><span class="p">):</span>
        <span class="n">FilterResponse</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="o">*</span><span class="n">wavelength_unit</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
                       <span class="n">meta</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">group_name</span><span class="o">=</span><span class="n">group_name</span><span class="p">,</span> <span class="n">band_name</span><span class="o">=</span><span class="n">filt_name</span><span class="p">))</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../f-modindex.html" title="Fortran Module Index"
             >fortran modules</a> |</li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">macauff</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">macauff.galaxy_counts</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2022, Tom J Wilson.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>